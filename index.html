<!DOCTYPE html>
<!-- ... (Ù†ÙØ³ ÙƒÙˆØ¯ HTML Ùˆ CSS Ø§Ù„Ø°ÙŠ Ù‚Ø¯Ù…ØªÙ‡ Ù„Ùƒ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø£Ø®ÙŠØ±ØŒ Ù…Ù† <!DOCTYPE> Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© </style>) ... -->

<body>
  <!-- ... (Ù†ÙØ³ ÙƒÙˆØ¯ body Ù…Ù† <div class="modal"> Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© </footer>) ... -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // --- Configuration ---
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxhK9XSGk4_0-x6kgfAh6Zy4QNuWuYUB1ouHv7rwoeGGJOjGE36RivCWaxrvrD4GIvC3w/exec'; // ğŸ”´ğŸ”´ğŸ”´ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const CLINIC_WHATSAPP_NUMBER = '201006404614';
    // ... (Ù†ÙØ³ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± DOM)

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', async () => {
        // ... (Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©)
        await generateTokenOnLoad();
        await loadDoctorSchedules();
        // ... (Ù†ÙØ³ event listeners)
    });

    // --- Security & Data Fetching (All GET requests) ---
    async function generateTokenOnLoad() {
        try {
            const response = await fetch(`${WEB_APP_URL}?action=generateToken`);
            if (!response.ok) throw new Error('Network response was not ok');
            currentToken = await response.text();
        } catch (error) {
            console.error("Could not generate token:", error);
            handleError("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¢Ù…Ù†Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.", document.getElementById('heroBookingCard'));
        }
    }

    async function loadDoctorSchedules() {
        try {
            const response = await fetch(`${WEB_APP_URL}?action=getDoctorSchedules`);
            if (!response.ok) throw new Error('Network response was not ok');
            doctorSchedules = await response.json();
            // ... (Ù†ÙØ³ ÙƒÙˆØ¯ Ù…Ù„Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆÙ‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡)
        } catch (error) {
            console.error('Failed to load doctor schedules:', error);
            doctorCardsContainer.innerHTML = '<p class="text-danger text-center">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
        }
    }

    async function updateAvailableTimes() {
        // ... (Ù†ÙØ³ ÙƒÙˆØ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙˆÙ‚Ø§ØªØŒ ÙŠØ³ØªØ®Ø¯Ù… GET Ø¨Ø§Ù„ÙØ¹Ù„)
    }

    // --- Form Submission (The Main Change) ---
    mainForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        mainMessageArea.innerHTML = '';
        if (!mainForm.checkValidity() || !currentToken) {
            mainForm.classList.add('was-validated');
            if (!currentToken) handleError("Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
            return;
        }

        mainSubmitButton.disabled = true;
        mainSubmitButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ£ÙƒÙŠØ¯...`;
        
        const formData = { /* ... (Ù†ÙØ³ ÙƒÙˆØ¯ ØªØ¬Ù…ÙŠØ¹ formData) */ };

        try {
            // ======== Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù‡Ù†Ø§: Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ Ø´ÙŠØ¡ ÙƒÙ€ GET ========
            const dataString = encodeURIComponent(JSON.stringify(formData));
            const response = await fetch(`${WEB_APP_URL}?action=bookAppointment&data=${dataString}`);
            
            const result = await response.json();

            if (result.status === 'success') {
                handleSuccess(formData);
            } else {
                handleError(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.');
            }

        } catch (error) {
            console.error('Fetch Error:', error);
            handleError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        } finally {
            await generateTokenOnLoad(); // Regenerate token for next submission
            mainSubmitButton.disabled = false;
            mainSubmitButton.innerHTML = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²';
        }
    });

    // --- User Experience Functions ---
    // ... (Ù†ÙØ³ Ø¯ÙˆØ§Ù„ handleSuccess, handleError, showMessage)
  </script>
</body>
</html>