<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ - Ø±Ø¹Ø§ÙŠØ© Ø·Ø¨ÙŠØ© ØªØ«Ù‚ Ø¨Ù‡Ø§</title>
  <meta name="description" content="Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ: Ù†Ø®Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ† ÙˆØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©. Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†.">
  <meta name="keywords" content="Ø¹ÙŠØ§Ø¯Ø©, Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯, Ø·Ø¨ÙŠØ¨, Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ, Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©, Ø¬Ø±Ø§Ø­Ø©, Ù†Ø³Ø§Ø¡ ÙˆØªÙˆÙ„ÙŠØ¯, Ø¨Ø§Ø·Ù†ÙŠØ©">

  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <meta property="og:title" content="Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ - Ø±Ø¹Ø§ÙŠØ© Ø·Ø¨ÙŠØ© ØªØ«Ù‚ Ø¨Ù‡Ø§">
  <meta property="og:description" content="Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ø¹ Ù†Ø®Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ†.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1576091160550-2173dba999ef">
  <meta property="og:url" content=""> <!-- ğŸ”´ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù‡Ù†Ø§ -->

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --dark-blue: #0a192f;
      --light-blue: #112240;
      --accent-orange: #fd7e14;
      --accent-orange-hover: #e87311;
      --light-gray: #f8f9fa;
      --text-light: #ccd6f6;
    }
    body { font-family: 'Tajawal', sans-serif; background-color: var(--light-gray); scroll-behavior: smooth; }
    .navbar { background-color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .navbar-brand { font-weight: 700; }
    .btn-navbar { background-color: var(--accent-orange); color: white; border-radius: 50px; padding: 8px 25px; transition: all 0.3s ease; }
    .btn-navbar:hover { background-color: var(--accent-orange-hover); transform: translateY(-2px); }
    .hero { background-color: var(--dark-blue); color: white; padding: 80px 0; position: relative; overflow: hidden; }
    .hero-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1576091160550-2173dba999ef?q=80&w=2070') no-repeat center center; background-size: cover; opacity: 0.1; z-index: 1; }
    .hero .container { position: relative; z-index: 2; }
    .hero h1 { font-size: 3.2rem; font-weight: 700; }
    .hero .lead { color: var(--text-light); }
    .hero-booking-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 30px; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.2); }
    .hero-booking-card .btn-primary { background-color: var(--accent-orange); border-color: var(--accent-orange); }
    .hero-booking-card .btn-primary:hover { background-color: var(--accent-orange-hover); border-color: var(--accent-orange-hover); }
    .section-title { text-align: center; margin-bottom: 50px; font-weight: 700; }
    .section-title::after { content: ''; display: block; width: 60px; height: 4px; background: var(--accent-orange); margin: 15px auto 0; border-radius: 2px; }
    .doctor-card { background: white; transition: transform .3s ease, box-shadow .3s ease; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-radius: 16px; overflow: hidden; }
    .doctor-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.12); }
    .doctor-card img { height: 250px; object-fit: cover; }
    .doctor-schedule { font-size: 0.9rem; color: #6c757d; }
    .doctor-schedule i { color: var(--accent-orange); margin-inline-end: 8px; }
    .advanced-booking-section { background-color: var(--dark-blue); color: white; padding: 80px 0; }
    .advanced-booking-section h2 { font-weight: 700; }
    .advanced-booking-section .lead { color: var(--text-light); }
    .advanced-booking-form { background: white; color: #333; border-radius: 16px; padding: 30px; }
    .advanced-booking-form .btn-primary { background-color: var(--accent-orange); border-color: var(--accent-orange); }
    .advanced-booking-form .btn-primary:hover { background-color: var(--accent-orange-hover); border-color: var(--accent-orange-hover); }
    .contact-section { background: white; padding: 80px 0; }
    .contact-info-card { padding: 30px; background-color: var(--light-gray); border-radius: 16px; height: 100%; }
    .contact-info-item { display: flex; align-items: center; margin-bottom: 20px; font-size: 1.1rem; }
    .contact-info-item i { font-size: 1.5rem; color: var(--accent-orange); width: 40px; }
    .social-icons a { font-size: 1.8rem; margin-inline-start: 20px; color: #343a40; transition: color 0.3s; }
    .social-icons a:hover { color: var(--accent-orange); }
    .footer { background-color: var(--dark-blue); color: var(--text-light); text-align: center; padding: 40px 20px; }
  </style>
</head>
<body>
  
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0"><h5 class="modal-title">âœ… ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body text-center">
          <p>Ù…Ù„Ø®Øµ Ù…ÙˆØ¹Ø¯Ùƒ:</p>
          <ul class="list-unstyled"><li id="modalPatientName"></li><li id="modalDoctorName"></li><li id="modalDateTime"></li></ul>
        </div>
        <div class="modal-footer border-0 justify-content-center"><a href="#" id="whatsappLink" target="_blank" class="btn btn-success"><i class="fab fa-whatsapp"></i> Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</a></div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"><a class="nav-link" href="#doctors">Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
        <a href="#booking" class="btn btn-navbar d-none d-lg-inline-block">Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</a>
      </div>
    </div>
  </nav>

  <header class="hero" id="home">
    <div class="hero-bg"></div>
    <div class="container">
      <div class="row align-items-center g-5">
        <div class="col-lg-7 text-lg-start text-center">
          <h1>Ø±Ø¹Ø§ÙŠØ© Ø·Ø¨ÙŠØ© ØªØ«Ù‚ Ø¨Ù‡Ø§ØŒ Ù„Ø­ÙŠØ§Ø© Ø£ÙØ¶Ù„</h1>
          <p class="lead my-4">Ù†Ø®Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ† ÙˆØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø© Ù„Ø¶Ù…Ø§Ù† Ø±Ø§Ø­ØªÙƒ ÙˆØµØ­ØªÙƒ.</p>
        </div>
        <div class="col-lg-5">
          <div id="heroBookingCard" class="hero-booking-card">
            <h4 class="mb-4">Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹</h4>
            <div class="mb-3">
                <select id="heroDoctorSelect" class="form-select">
                    <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø£ÙˆÙ„Ø§Ù‹</option>
                </select>
            </div>
            <div class="mb-3">
                <input type="date" class="form-control" id="heroDateInput">
            </div>
            <button class="btn btn-primary w-100" id="heroBookBtn">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¬Ø²</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="container my-5 py-5" id="doctors">
      <h2 class="section-title">ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙØ±ÙŠÙ‚Ù†Ø§ Ø§Ù„Ø·Ø¨ÙŠ</h2>
      <div id="doctorCardsContainer" class="row g-4 justify-content-center">
        <div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>
      </div>
    </section>

    <section class="advanced-booking-section" id="booking">
      <div class="container">
        <div class="row align-items-center g-5">
          <div class="col-lg-6">
            <h2 class="display-5">Ø¹ÙŠØ§Ø¯Ø© Ù…Ø¹ØªÙ…Ø¯Ø© ÙˆØ­Ø§Ø¦Ø²Ø© Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒÙ…</h2>
            <p class="lead mt-4">Ù†Ø­Ù† Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ù…Ø¹ ÙØ±ÙŠÙ‚ Ù…Ù† Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡ Ù„Ø¶Ù…Ø§Ù† ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø±Ø¹Ø§ÙŠØ© ØµØ­ÙŠØ© Ù„Ùƒ ÙˆÙ„Ø¹Ø§Ø¦Ù„ØªÙƒ.</p>
          </div>
          <div class="col-lg-6">
            <div class="advanced-booking-form">
              <h3 class="text-center mb-4">Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h3>
              <form id="mainBookingForm" novalidate>
                 <div class="mb-3"><label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" class="form-control" id="mainPatientName" required></div>
                 <div class="mb-3"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" class="form-control" id="mainPatientPhone" required></div>
                 <div class="mb-3"><label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</label><select id="mainDoctorSelect" class="form-select" required></select></div>
                 <div class="row g-3">
                    <div class="col-md-6"><label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" class="form-control" id="mainDateInput" required></div>
                    <div class="col-md-6"><label class="form-label">Ø§Ù„ÙˆÙ‚Øª</label><select id="mainTimeSelect" class="form-select" required disabled><option value="">Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¨Ù‹Ø§ ÙˆØªØ§Ø±ÙŠØ®Ù‹Ø§</option></select></div>
                 </div>
                 <div id="mainMessageArea" class="mt-4"></div>
                 <button type="submit" class="btn btn-primary w-100 mt-3" id="mainSubmitButton">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="contact-section" id="contact">
      <div class="container">
        <h2 class="section-title">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h2>
        <div class="row g-4 align-items-center">
          <div class="col-lg-6">
            <div class="contact-info-card">
              <div class="contact-info-item"><i class="fas fa-map-marker-alt"></i><span>446 Ø´ ÙÙŠØµÙ„-Ø¨Ø±Ø¬ Ø§Ù„Ù†ØµØ±ØŒ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±</span></div>
              <div class="contact-info-item"><i class="fas fa-phone"></i><a href="tel:+201006404614" class="text-decoration-none text-dark">01006404614</a></div>
              <div class="contact-info-item"><i class="fas fa-envelope"></i><a href="mailto:shamymediaeg@gmail.com" class="text-decoration-none text-dark">shamymediaeg@gmail.com</a></div>
              <hr class="my-4">
              <h5 class="mb-3">ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰:</h5>
              <div class="social-icons"><a href="#"><i class="fab fa-instagram"></i></a><a href="#"><i class="fab fa-twitter"></i></a><a href="#"><i class="fab fa-facebook-f"></i></a></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="ratio ratio-16x9" style="border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08);"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4053.110004188214!2d31.195507575552554!3d30.013462674939177!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x145846edbfabd573%3A0xf1694f2f21218509!2sDr.%20Abdelaziz%20Moussa%20-%20Alshomoukh%20Dentistry!5e1!3m2!1sen!2seg!4v1762983722731!5m2!1sen!2seg" allowfullscreen="" loading="lazy"></iframe></div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <footer class="footer"><p>Â© 2025 Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p></footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxhK9XSGk4_0-x6kgfAh6Zy4QNuWuYUB1ouHv7rwoeGGJOjGE36RivCWaxrvrD4GIvC3w/exec'; // ğŸ”´ğŸ”´ğŸ”´ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const CLINIC_WHATSAPP_NUMBER = '201006404614';
    const daysOfWeekArabic = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
    let currentToken;
    let doctorSchedules;
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    const mainForm = document.getElementById('mainBookingForm');
    const mainDoctorSelect = document.getElementById('mainDoctorSelect');
    const mainDateInput = document.getElementById('mainDateInput');
    const mainTimeSelect = document.getElementById('mainTimeSelect');
    const mainSubmitButton = document.getElementById('mainSubmitButton');
    const mainMessageArea = document.getElementById('mainMessageArea');
    const mainPatientNameInput = document.getElementById('mainPatientName');
    const mainPatientPhoneInput = document.getElementById('mainPatientPhone');
    const doctorCardsContainer = document.getElementById('doctorCardsContainer');
    const heroDoctorSelect = document.getElementById('heroDoctorSelect');
    const heroDateInput = document.getElementById('heroDateInput');
    const heroBookBtn = document.getElementById('heroBookBtn');
    
    document.addEventListener('DOMContentLoaded', async () => {
        const today = new Date().toISOString().split('T')[0];
        mainDateInput.min = today;
        heroDateInput.min = today;
        await generateTokenOnLoad();
        await loadDoctorSchedules();
        mainDoctorSelect.addEventListener('change', updateAvailableTimes);
        mainDateInput.addEventListener('change', updateAvailableTimes);
        heroBookBtn.addEventListener('click', () => {
            const selectedDoctor = heroDoctorSelect.value;
            const selectedDate = heroDateInput.value;
            if (selectedDoctor) mainDoctorSelect.value = selectedDoctor;
            if (selectedDate) mainDateInput.value = selectedDate;
            if (selectedDoctor && selectedDate) { updateAvailableTimes(); }
            document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
        });
    });

    async function generateTokenOnLoad() {
        try {
            const response = await fetch(`${WEB_APP_URL}?action=generateToken`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            currentToken = await response.text();
        } catch (error) {
            console.error("Could not generate token:", error);
            handleError("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¢Ù…Ù†Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.", document.getElementById('heroBookingCard'));
        }
    }

    async function loadDoctorSchedules() {
        try {
            const response = await fetch(`${WEB_APP_URL}?action=getDoctorSchedules`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            doctorSchedules = await response.json();
            doctorCardsContainer.innerHTML = ''; 
            mainDoctorSelect.innerHTML = '<option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ --</option>';
            heroDoctorSelect.innerHTML = '<option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø£ÙˆÙ„Ø§Ù‹</option>';
            for (const key in doctorSchedules) {
                const doctor = doctorSchedules[key];
                const scheduleDays = doctor.days.map(d => daysOfWeekArabic[d]).join('ØŒ ');
                const imageName = key.toLowerCase().replace('.', '').replace(/\s/g, '_') + '.png';
                const card = `
                    <div class="col-lg-4 col-md-6">
                        <div class="card doctor-card h-100">
                            <img loading="lazy" src="images/${imageName}" class="card-img-top" alt="${doctor.name}">
                            <div class="card-body text-center d-flex flex-column">
                                <h5 class="fw-bold">${doctor.name}</h5>
                                <p class="text-muted">${doctor.specialty}</p>
                                <hr class="my-3">
                                <div class="doctor-schedule text-start mt-auto">
                                    <p class="mb-2"><i class="far fa-calendar-alt"></i><strong>Ø§Ù„Ø£ÙŠØ§Ù…:</strong> ${scheduleDays}</p>
                                    <p class="mb-0"><i class="far fa-clock"></i><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${doctor.startHour}:00 - ${doctor.endHour}:00</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
                doctorCardsContainer.innerHTML += card;
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${doctor.name} - ${doctor.specialty}`;
                mainDoctorSelect.appendChild(option.cloneNode(true));
                heroDoctorSelect.appendChild(option.cloneNode(true));
            }
        } catch (error) {
            console.error('Failed to load doctor schedules:', error);
            doctorCardsContainer.innerHTML = '<p class="text-danger text-center">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
        }
    }

    async function updateAvailableTimes() {
        const doctorKey = mainDoctorSelect.value;
        const dateString = mainDateInput.value;
        mainTimeSelect.disabled = true;
        mainTimeSelect.innerHTML = '<option>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...</option>';
        if (!doctorKey || !dateString) {
            mainTimeSelect.innerHTML = '<option value="" selected disabled>Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¨Ù‹Ø§ ÙˆØªØ§Ø±ÙŠØ®Ù‹Ø§</option>';
            return;
        }
        try {
            const response = await fetch(`${WEB_APP_URL}?action=getAvailableTimes&doctor=${doctorKey}&date=${dateString}`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const times = await response.json();
            mainTimeSelect.innerHTML = '';
            if (times.length > 0) {
                times.forEach(time => {
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    mainTimeSelect.appendChild(option);
                });
                mainTimeSelect.disabled = false;
            } else {
                mainTimeSelect.innerHTML = '<option value="" disabled>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø©</option>';
            }
        } catch (error) {
            console.error('Failed to get available times:', error);
            mainTimeSelect.innerHTML = '<option value="" disabled>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</option>';
        }
    }

    mainForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        mainMessageArea.innerHTML = '';
        if (!mainForm.checkValidity() || !currentToken) {
            mainForm.classList.add('was-validated');
            if (!currentToken) handleError("Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
            return;
        }
        mainSubmitButton.disabled = true;
        mainSubmitButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ£ÙƒÙŠØ¯...`;
        const formData = { 
            patientName: mainPatientNameInput.value.trim(), 
            patientPhone: mainPatientPhoneInput.value.trim(), 
            doctor: mainDoctorSelect.value, 
            date: mainDateInput.value, 
            time: mainTimeSelect.value, 
            token: currentToken 
        };
        try {
            const dataString = encodeURIComponent(JSON.stringify(formData));
            const response = await fetch(`${WEB_APP_URL}?action=bookAppointment&data=${dataString}`);
            const result = await response.json();
            if (result.status === 'success') {
                handleSuccess(formData);
            } else {
                handleError(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.');
            }
        } catch (error) {
            console.error('Fetch Error:', error);
            handleError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        } finally {
            await generateTokenOnLoad();
            mainSubmitButton.disabled = false;
            mainSubmitButton.innerHTML = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²';
        }
    });

    function handleSuccess(formData) {
        const doctorData = doctorSchedules[formData.doctor];
        document.getElementById('modalPatientName').textContent = `Ø§Ù„Ø§Ø³Ù…: ${formData.patientName}`;
        document.getElementById('modalDoctorName').textContent = `Ø§Ù„Ø·Ø¨ÙŠØ¨: ${doctorData.name}`;
        document.getElementById('modalDateTime').textContent = `Ø§Ù„Ù…ÙˆØ¹Ø¯: ${formData.date} Ø§Ù„Ø³Ø§Ø¹Ø© ${formData.time}`;
        const whatsappMessage = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ø§Ù…ÙŠØŒ\nÙ„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¨Ø§Ø³Ù…: ${formData.patientName}\nÙ…Ø¹: ${doctorData.name}\nÙÙŠ ØªØ§Ø±ÙŠØ®: ${formData.date} Ø§Ù„Ø³Ø§Ø¹Ø©: ${formData.time}.\nØ´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ….`;
        const whatsappURL = `https://wa.me/${CLINIC_WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`;
        document.getElementById('whatsappLink').href = whatsappURL;
        successModal.show();
        mainForm.reset();
        mainForm.classList.remove('was-validated');
        mainDateInput.min = new Date().toISOString().split('T')[0];
        mainTimeSelect.innerHTML = '<option value="" selected disabled>Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¨Ù‹Ø§ ÙˆØªØ§Ø±ÙŠØ®Ù‹Ø§</option>';
    }

    function handleError(message, container = mainMessageArea) {
        showMessage(message, 'danger', container);
    }

    function showMessage(message, type, container = mainMessageArea) {
        const alertType = type === 'success' ? 'success' : 'danger';
        container.innerHTML = `<div class="alert alert-${alertType} alert-dismissible fade show" role="alert">${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`;
    }
  </script>
</body>
</html>