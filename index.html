<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>عيادة الشامي - رعاية طبية تثق بها</title>
  <meta name="description" content="عيادة الشامي: نخبة من الأطباء المتخصصين وتقنيات حديثة. احجز موعدك الآن بسهولة وأمان.">

  <!-- تم التأكيد: استخدام المسار النسبي الصحيح -->
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    * { -webkit-font-smoothing: antialiased; }
    :root {
      --dark-blue: #0a192f;
      --accent-orange: #fd7e14;
      --accent-orange-hover: #e87311;
      --light-gray: #f8f9fa;
      --text-light: #ccd6f6;
      --bs-primary: #0d6efd;
    }
    body { font-family: 'Tajawal', sans-serif; background-color: var(--light-gray); scroll-behavior: smooth; }
    .navbar { background-color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .navbar-brand img { height: 40px; }
    .btn-navbar { background-color: var(--accent-orange); color: white; border-radius: 50px; padding: 8px 25px; transition: all 0.3s ease; }
    .btn-navbar:hover { background-color: var(--accent-orange-hover); transform: translateY(-2px); }
    
    .hero { background-color: var(--dark-blue); color: white; padding: 80px 0; position: relative; overflow: hidden; }
    .hero-bg {
      position: absolute;
      inset: 0;
      background: url('https://plus.unsplash.com/premium_photo-1681966883482-8663ac9a95a7?q=80') center/cover no-repeat;
      opacity: 0.15;
      z-index: 1;
    }
    .hero .container { position: relative; z-index: 2; }
    .hero h1 { font-size: 3.2rem; font-weight: 700; }
    .hero .lead { color: var(--text-light); }
    .hero-booking-card { background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(6px); padding: 22px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.06); }
    
    .section-title { text-align: center; margin-bottom: 50px; font-weight: 700; color: var(--dark-blue); }
    .section-title::after { content: ''; display: block; width: 60px; height: 4px; background: var(--accent-orange); margin: 15px auto 0; border-radius: 2px; }
    
    #doctors { background-color: #f0f4f8; }
    .specialist-card {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
      transition: all 0.3s ease;
      text-align: center;
      display: flex;
      flex-direction: column;
    }
    .specialist-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    .specialist-card .card-header { background-color: var(--bs-primary); padding: 10px; }
    .specialist-card .social-icons a { color: white; margin: 0 8px; font-size: 1rem; opacity: 0.7; transition: opacity 0.3s; }
    .specialist-card .social-icons a:hover { opacity: 1; }
    .specialist-card .card-img-container { padding: 20px; background-color: #f8f9fa; }
    .specialist-card img { width: 150px; height: 150px; object-fit: cover; border-radius: 50%; border: 4px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .specialist-card .card-body { background-color: var(--bs-primary); color: white; padding: 20px 15px; flex-grow: 1; }
    .specialist-card .card-body h5 { font-weight: 700; margin-bottom: 8px; }
    .specialist-card .card-body p { font-size: 0.9rem; opacity: 0.9; }

    .advanced-booking-section { background-color: var(--dark-blue); color: white; padding: 80px 0; }
    .advanced-booking-form { background: white; color: #333; border-radius: 16px; padding: 30px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
    .advanced-booking-form .btn-primary, .hero-booking-card .btn-primary { background-color: var(--accent-orange); border-color: var(--accent-orange); }
    .advanced-booking-form .btn-primary:hover, .hero-booking-card .btn-primary:hover { background-color: var(--accent-orange-hover); border-color: var(--accent-orange-hover); }
    
    .contact-section { background: var(--light-gray); padding: 80px 0; }
    .contact-info-card { background: white; padding: 30px; border-radius: 16px; height: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .contact-info-item { display: flex; align-items: center; margin-bottom: 20px; font-size: 1.1rem; }
    .contact-info-item i { font-size: 1.5rem; color: var(--accent-orange); width: 40px; }
    .contact-info-card .social-icons a { font-size: 1.5rem; margin-inline-start: 15px; color: #343a40; transition: color 0.3s; }
    .contact-info-card .social-icons a:hover { color: var(--accent-orange); }

    .footer { background-color: var(--dark-blue); color: var(--text-light); text-align: center; padding: 40px 20px; }
  </style>
</head>
<body>
  
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0"><h5 class="modal-title">✅ تم الحجز بنجاح!</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body text-center"><p id="modalSummary"></p></div>
        <div class="modal-footer border-0 justify-content-center"><a id="whatsappLink" class="btn btn-success" target="_blank"><i class="fab fa-whatsapp"></i> تأكيد عبر واتساب</a></div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
          <img src="./images/apple-touch-icon.png" alt="شعار عيادة الشامي">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"><a class="nav-link" href="#doctors">الأطباء</a></li>
          <li class="nav-item"><a class="nav-link" href="#booking">الحجز</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">تواصل معنا</a></li>
        </ul>
        <a href="#booking" class="btn btn-navbar d-none d-lg-inline-block">احجز الآن</a>
      </div>
    </div>
  </nav>

  <header class="hero" id="home">
    <div class="hero-bg"></div>
    <div class="container">
      <div class="row align-items-center g-5">
        <div class="col-lg-7 text-lg-start text-center">
          <h1>رعاية طبية تثق بها، لحياة أفضل</h1>
          <p class="lead my-4">نخبة من الأطباء المتخصصين وتقنيات حديثة لضمان راحتك وصحتك.</p>
        </div>
        <div class="col-lg-5">
          <div id="heroBookingCard" class="hero-booking-card">
            <h4 class="mb-3">حجز سريع</h4>
            <div class="mb-2"><select id="heroDoctorSelect" class="form-select"><option value="" disabled selected>اختر الطبيب</option></select></div>
            <div class="mb-2"><input type="date" id="heroDateInput" class="form-control"></div>
            <button id="heroBookBtn" class="btn btn-primary w-100">متابعة الحجز</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="py-5" id="doctors">
      <div class="container my-5">
        <h2 class="section-title">فريقنا الطبي المتخصص</h2>
        <div id="doctorCardsContainer" class="row g-4 justify-content-center">
          <div class="text-center w-100"><div class="spinner-border" style="width: 3rem; height: 3rem; color: var(--accent-orange);" role="status"><span class="visually-hidden">Loading...</span></div></div>
        </div>
      </div>
    </section>

    <!-- تم الإصلاح: إضافة محتوى قسم الحجز المتقدم بالكامل -->
    <section class="advanced-booking-section" id="booking">
        <div class="container">
            <div class="row align-items-center g-5">
              <div class="col-lg-6">
                <h2 class="display-5">احجز موعدك بسهولة وأمان</h2>
                <p class="lead mt-4">نظامنا يضمن لك حجز موعدك مع الطبيب المفضل في الوقت المناسب لك دون أي تعارضات.</p>
              </div>
              <div class="col-lg-6">
                <div class="advanced-booking-form">
                  <h3 class="text-center mb-4">أكمل بيانات الحجز</h3>
                  <form id="mainBookingForm" novalidate>
                     <div class="mb-3"><label class="form-label">الاسم الكامل</label><input id="mainPatientName" class="form-control" required></div>
                     <div class="mb-3"><label class="form-label">رقم الهاتف (واتساب)</label><input id="mainPatientPhone" class="form-control" required type="tel"></div>
                     <div class="mb-3"><label class="form-label">اختر الطبيب</label><select id="mainDoctorSelect" class="form-select" required></select></div>
                     <div class="row g-3">
                        <div class="col-md-6"><label class="form-label">التاريخ</label><input id="mainDateInput" type="date" class="form-control" required></div>
                        <div class="col-md-6"><label class="form-label">الوقت</label><select id="mainTimeSelect" class="form-select" required disabled><option>اختر طبيبًا وتاريخًا</option></select></div>
                     </div>
                     <div id="mainMessageArea" class="mt-3"></div>
                     <button id="mainSubmitButton" class="btn btn-primary w-100 mt-3" type="submit">تأكيد الحجز</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
    </section>
    
    <!-- تم الإصلاح: إضافة محتوى قسم التواصل بالكامل -->
    <section class="contact-section" id="contact">
      <div class="container">
        <h2 class="section-title">تواصل معنا</h2>
        <div class="row g-4 align-items-center">
          <div class="col-lg-6">
            <div class="contact-info-card">
              <div class="contact-info-item"><i class="fas fa-map-marker-alt"></i><span>446 ش فيصل - برج النصر، القاهرة، مصر</span></div>
              <div class="contact-info-item"><i class="fas fa-phone"></i><a href="tel:+201006404614" class="text-decoration-none text-dark">01006404614</a></div>
              <div class="contact-info-item"><i class="fas fa-envelope"></i><a href="mailto:shamymediaeg@gmail.com" class="text-decoration-none text-dark">shamymediaeg@gmail.com</a></div>
              <hr class="my-4">
              <h5 class="mb-3">تابعنا على:</h5>
              <div class="social-icons"><a href="#" target="_blank"><i class="fab fa-instagram"></i></a><a href="#" target="_blank"><i class="fab fa-twitter"></i></a><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="ratio ratio-16x9" style="border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4053.110004188214!2d31.195507575552554!3d30.013462674939177!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x145846edbfabd573%3A0xf1694f2f21218509!2sDr.%20Abdelaziz%20Moussa%20-%20Alshomoukh%20Dentistry!5e1!3m2!1sen!2seg!4v1762983722731!5m2!1sen!2seg" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
  
  <footer class="footer">
    <div class="container"><p>© 2025 عيادة الشامي. جميع الحقوق محفوظة.</p></div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // =================================================================
    // JavaScript - النسخة النهائية والجاهزة للنشر
    // =================================================================

    // ⚡⚡⚡ تنبيه هام جدًا ⚡⚡⚡
    // استبدل الرابط التالي بالرابط الحقيقي الذي حصلت عليه بعد نشر Google Apps Script
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyow5jzkiMwO92mM7u9FjCrmfYcw55PRa3kalEj7JNODUMt0qQJ1vx6ezLHStgM89I9iA/exec';
    
    const CLINIC_WHATSAPP_NUMBER = '201006404614';

    // تم الإصلاح: تعريف جميع متغيرات الواجهة الرسومية (DOM Elements)
    const doctorCardsContainer = document.getElementById('doctorCardsContainer');
    const mainForm = document.getElementById('mainBookingForm');
    const mainDoctorSelect = document.getElementById('mainDoctorSelect');
    const mainDateInput = document.getElementById('mainDateInput');
    const mainTimeSelect = document.getElementById('mainTimeSelect');
    const mainSubmitButton = document.getElementById('mainSubmitButton');
    const mainMessageArea = document.getElementById('mainMessageArea');
    const mainPatientNameInput = document.getElementById('mainPatientName');
    const mainPatientPhoneInput = document.getElementById('mainPatientPhone');
    
    const heroDoctorSelect = document.getElementById('heroDoctorSelect');
    const heroDateInput = document.getElementById('heroDateInput');
    const heroBookBtn = document.getElementById('heroBookBtn');
    
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    let currentToken = null;
    let doctorSchedules = null;

    const today = new Date().toISOString().split('T')[0];
    mainDateInput.min = today;
    heroDateInput.min = today;

    // تم الإصلاح: تفعيل الـ Event Listeners عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', async () => {
      await generateTokenOnLoad();
      await loadDoctorSchedules();
      
      mainDoctorSelect.addEventListener('change', updateAvailableTimes);
      mainDateInput.addEventListener('change', updateAvailableTimes);
      
      heroBookBtn.addEventListener('click', () => {
        const selectedDoctor = heroDoctorSelect.value;
        const selectedDate = heroDateInput.value;
        if (!selectedDoctor || !selectedDate) {
          alert('اختر الطبيب والتاريخ أولاً للمتابعة');
          return;
        }
        mainDoctorSelect.value = selectedDoctor;
        mainDateInput.value = selectedDate;
        updateAvailableTimes(); // تحديث قائمة الأوقات تلقائياً
        document.getElementById('booking').scrollIntoView({ behavior: 'smooth' }); // الانتقال إلى قسم الحجز
      });
    });

    async function generateTokenOnLoad() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=generateToken`);
        if (!res.ok) throw new Error('فشل طلب التوكن');
        currentToken = await res.text();
      } catch (err) {
        console.error('Token generation error', err);
        showMessage('لا يمكن بدء جلسة آمنة. يرجى تحديث الصفحة.', 'danger', document.querySelector('.hero-booking-card'));
      }
    }

    async function loadDoctorSchedules() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getDoctorSchedules`);
        if (!res.ok) throw new Error('فشل الاتصال بالخادم. تأكد من صحة رابط السكريبت.');
        doctorSchedules = await res.json();
        
        doctorCardsContainer.innerHTML = '';
        mainDoctorSelect.innerHTML = '<option value="" selected disabled>-- اختر الطبيب --</option>';
        heroDoctorSelect.innerHTML = '<option value="" selected disabled>اختر الطبيب</option>';

        for (const key in doctorSchedules) {
          const d = doctorSchedules[key];
          
          // تم الإصلاح: منطق أكثر قوة لتوليد أسماء الصور
          const imageName = key.toLowerCase().replace(/dr\.?\s*/g, "dr_").replace(/\s+/g, "_") + ".png";
          
          const cardHtml = `
            <div class="col-lg-3 col-md-6 mb-4">
              <div class="specialist-card h-100">
                <div class="card-header">
                  <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                  </div>
                </div>
                <div class="card-img-container">
                    <img loading="lazy" src="./images/${imageName}" class="img-fluid" alt="${d.name}">
                </div>
                <div class="card-body">
                  <h5 class="card-title">${d.name}</h5>
                  <p class="card-text">${d.specialty}</p>
                </div>
              </div>
            </div>`;
          doctorCardsContainer.insertAdjacentHTML('beforeend', cardHtml);

          const opt = new Option(`${d.name} - ${d.specialty}`, key);
          mainDoctorSelect.appendChild(opt.cloneNode(true));
          heroDoctorSelect.appendChild(opt);
        }
      } catch (err) {
        console.error('Failed to load doctor schedules:', err);
        doctorCardsContainer.innerHTML = `<p class="alert alert-danger text-center w-100">حدث خطأ أثناء تحميل بيانات الأطباء. يرجى تحديث الصفحة. (${err.message})</p>`;
      }
    }

    async function updateAvailableTimes() {
      const doctorKey = mainDoctorSelect.value;
      const date = mainDateInput.value;
      mainTimeSelect.disabled = true;
      mainTimeSelect.innerHTML = '<option>جاري تحميل المواعيد...</option>';
      if (!doctorKey || !date) {
        mainTimeSelect.innerHTML = '<option value="" selected disabled>اختر طبيبًا وتاريخًا</option>';
        return;
      }
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getAvailableTimes&doctor=${encodeURIComponent(doctorKey)}&date=${encodeURIComponent(date)}`);
        if (!res.ok) throw new Error('فشل تحميل الأوقات المتاحة');
        const times = await res.json();
        mainTimeSelect.innerHTML = '';
        if (Array.isArray(times) && times.length > 0) {
          times.forEach(t => mainTimeSelect.add(new Option(t, t)));
          mainTimeSelect.disabled = false;
        } else {
          mainTimeSelect.innerHTML = '<option value="" disabled>لا توجد مواعيد متاحة</option>';
        }
      } catch (err) {
        console.error('Failed to get available times:', err);
        mainTimeSelect.innerHTML = '<option value="" disabled>خطأ في تحميل المواعيد</option>';
      }
    }

    // تم الإصلاح: تفعيل دالة إرسال الحجز
    mainForm.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      mainMessageArea.innerHTML = '';
      if (!mainForm.checkValidity() || !currentToken) {
        mainForm.classList.add('was-validated');
        if (!currentToken) showMessage('جلسة منتهية، يرجى إعادة تحميل الصفحة.', 'danger');
        return;
      }
      mainSubmitButton.disabled = true;
      mainSubmitButton.innerHTML = `<span class="spinner-border spinner-border-sm"></span> جارٍ التأكيد...`;

      const payload = {
        patientName: mainPatientNameInput.value.trim(),
        patientPhone: mainPatientPhoneInput.value.trim(),
        doctor: mainDoctorSelect.value,
        date: mainDateInput.value,
        time: mainTimeSelect.value,
        token: currentToken
      };

      try {
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error(`فشل طلب الحجز. الحالة: ${res.status}`);
        const result = await res.json();
        
        if (result.status === 'success') {
          document.getElementById('modalSummary').textContent = `${payload.patientName} - ${payload.date} ${payload.time} مع ${doctorSchedules[payload.doctor].name}`;
          const waMsg = `مرحباً عيادة الشامي، لقد قمت بتأكيد حجز باسم ${payload.patientName} مع ${doctorSchedules[payload.doctor].name} في ${payload.date} الساعة ${payload.time}.`;
          document.getElementById('whatsappLink').href = `https://wa.me/${CLINIC_WHATSAPP_NUMBER}?text=${encodeURIComponent(waMsg)}`;
          successModal.show();
          mainForm.reset();
          mainForm.classList.remove('was-validated');
          mainTimeSelect.innerHTML = '<option value="" selected disabled>اختر طبيبًا وتاريخًا</option>';
        } else {
          showMessage(result.message || 'حدث خطأ غير معروف أثناء الحجز.', 'danger');
        }
      } catch (err) {
        console.error('Fetch Error:', err);
        showMessage('حدث خطأ في الاتصال. يرجى التحقق من الشبكة والمحاولة مرة أخرى.', 'danger');
      } finally {
        await generateTokenOnLoad();
        mainSubmitButton.disabled = false;
        mainSubmitButton.innerHTML = 'تأكيد الحجز';
      }
    });

    function showMessage(msg, type = 'danger', container = mainMessageArea) {
      container.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">${msg}<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
    }
  </script>
</body>
</html>
