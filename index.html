<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>عيادة الشامي - رعاية طبية تثق بها</title>
  <meta name="description" content="عيادة الشامي: نخبة من الأطباء المتخصصين وتقنيات حديثة. احجز موعدك الآن بسهولة وأمان.">

  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --dark-blue: #0a192f;
      --accent-orange: #fd7e14;
      --accent-orange-hover: #e87311;
      --light-gray: #f8f9fa;
      --text-light: #ccd6f6;
    }
    body { font-family: 'Tajawal', sans-serif; background-color: var(--light-gray); scroll-behavior: smooth; }
    .navbar { background-color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .navbar-brand { font-weight: 700; color: var(--dark-blue) !important; }
    .btn-navbar { background-color: var(--accent-orange); color: white; border-radius: 50px; padding: 8px 25px; transition: all 0.3s ease; }
    .btn-navbar:hover { background-color: var(--accent-orange-hover); transform: translateY(-2px); }
    .hero { background-color: var(--dark-blue); color: white; padding: 80px 0; position: relative; overflow: hidden; }
    .hero-bg { position: absolute; inset: 0; background: url('https://images.unsplash.com/photo-1576091160550-2173dba999ef?q=80&w=2070') center/cover no-repeat; opacity: 0.1; z-index: 1; }
    .hero .container { position: relative; z-index: 2; }
    .hero h1 { font-size: 3.2rem; font-weight: 700; }
    .hero .lead { color: var(--text-light); }
    .hero-booking-card { background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(6px); padding: 22px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.06); }
    .hero-booking-card .btn-primary { background-color: var(--accent-orange); border-color: var(--accent-orange); }
    .hero-booking-card .btn-primary:hover { background-color: var(--accent-orange-hover); border-color: var(--accent-orange-hover); }
    .section-title { text-align: center; margin-bottom: 50px; font-weight: 700; color: var(--dark-blue); }
    .section-title::after { content: ''; display: block; width: 60px; height: 4px; background: var(--accent-orange); margin: 15px auto 0; border-radius: 2px; }
    .doctor-card { background: white; transition: transform .3s ease, box-shadow .3s ease; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-radius: 16px; overflow: hidden; }
    .doctor-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.12); }
    .doctor-card img { height: 250px; object-fit: cover; }
    .doctor-schedule { font-size: 0.9rem; }
    .doctor-schedule i { color: var(--accent-orange); margin-inline-end: 8px; }
    .advanced-booking-section { background-color: var(--dark-blue); color: white; padding: 80px 0; }
    .advanced-booking-section h2 { font-weight: 700; }
    .advanced-booking-section .lead { color: var(--text-light); }
    .advanced-booking-form { background: white; color: #333; border-radius: 16px; padding: 30px; }
    .advanced-booking-form .btn-primary { background-color: var(--accent-orange); border-color: var(--accent-orange); }
    .advanced-booking-form .btn-primary:hover { background-color: var(--accent-orange-hover); border-color: var(--accent-orange-hover); }
    .contact-section { background: var(--light-gray); padding: 80px 0; }
    .contact-info-card { background: white; padding: 30px; border-radius: 16px; height: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .contact-info-item { display: flex; align-items: center; margin-bottom: 20px; font-size: 1.1rem; }
    .contact-info-item i { font-size: 1.5rem; color: var(--accent-orange); width: 40px; }
    .social-icons a { font-size: 1.5rem; margin-inline-start: 15px; color: #343a40; transition: color 0.3s; }
    .social-icons a:hover { color: var(--accent-orange); }
    .footer { background-color: var(--dark-blue); color: var(--text-light); text-align: center; padding: 40px 20px; }
  </style>
</head>
<body>
  
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0"><h5 class="modal-title">✅ تم الحجز بنجاح!</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body text-center"><p id="modalSummary"></p></div>
        <div class="modal-footer border-0 justify-content-center"><a id="whatsappLink" class="btn btn-success" target="_blank"><i class="fab fa-whatsapp"></i> فتح واتساب</a></div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">عيادة الشامي</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"><a class="nav-link" href="#doctors">الأطباء</a></li>
          <li class="nav-item"><a class="nav-link" href="#booking">الحجز</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">تواصل معنا</a></li>
        </ul>
        <a href="#booking" class="btn btn-navbar d-none d-lg-inline-block">احجز الآن</a>
      </div>
    </div>
  </nav>

  <header class="hero" id="home">
    <div class="hero-bg"></div>
    <div class="container">
      <div class="row align-items-center g-5">
        <div class="col-lg-7 text-lg-start text-center">
          <h1>رعاية طبية تثق بها، لحياة أفضل</h1>
          <p class="lead my-4">نخبة من الأطباء المتخصصين وتقنيات حديثة لضمان راحتك وصحتك.</p>
        </div>
        <div class="col-lg-5">
          <div id="heroBookingCard" class="hero-booking-card">
            <h4 class="mb-3">حجز سريع</h4>
            <div class="mb-2"><select id="heroDoctorSelect" class="form-select"><option value="" disabled selected>اختر الطبيب</option></select></div>
            <div class="mb-2"><input type="date" id="heroDateInput" class="form-control"></div>
            <button id="heroBookBtn" class="btn btn-primary w-100">متابعة الحجز</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="container my-5 py-5" id="doctors">
      <h2 class="section-title">تعرف على فريقنا الطبي</h2>
      <div id="doctorCardsContainer" class="row g-4 justify-content-center">
        <div class="text-center w-100"><div class="spinner-border" style="width: 3rem; height: 3rem; color: var(--accent-orange);" role="status"><span class="visually-hidden">Loading...</span></div></div>
      </div>
    </section>

    <section class="advanced-booking-section" id="booking">
      <div class="container">
        <div class="row align-items-center g-5">
          <div class="col-lg-6">
            <h2 class="display-5">عيادة معتمدة وحائزة على ثقتكم</h2>
            <p class="lead mt-4">نحن نستخدم أحدث التقنيات مع فريق من الخبراء لضمان تقديم أفضل رعاية صحية لك ولعائلتك.</p>
          </div>
          <div class="col-lg-6">
            <div class="advanced-booking-form">
              <h3 class="text-center mb-4">أكمل بيانات الحجز</h3>
              <form id="mainBookingForm" novalidate>
                 <div class="mb-3"><label class="form-label">الاسم الكامل</label><input id="mainPatientName" class="form-control" required></div>
                 <div class="mb-3"><label class="form-label">رقم الهاتف (واتساب)</label><input id="mainPatientPhone" class="form-control" required></div>
                 <div class="mb-3"><label class="form-label">اختر الطبيب</label><select id="mainDoctorSelect" class="form-select" required></select></div>
                 <div class="row g-3">
                    <div class="col-md-6"><label class="form-label">التاريخ</label><input id="mainDateInput" type="date" class="form-control" required></div>
                    <div class="col-md-6"><label class="form-label">الوقت</label><select id="mainTimeSelect" class="form-select" required disabled><option>اختر طبيبًا وتاريخًا</option></select></div>
                 </div>
                 <div id="mainMessageArea" class="mt-3"></div>
                 <button id="mainSubmitButton" class="btn btn-primary w-100 mt-3" type="submit">تأكيد الحجز</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="contact-section" id="contact">
      <div class="container">
        <h2 class="section-title">تواصل معنا</h2>
        <div class="row g-4 align-items-center">
          <div class="col-lg-6">
            <div class="contact-info-card">
              <div class="contact-info-item"><i class="fas fa-map-marker-alt"></i><span>446 ش فيصل - برج النصر، القاهرة، مصر</span></div>
              <div class="contact-info-item"><i class="fas fa-phone"></i><a href="tel:+201006404614" class="text-decoration-none text-dark">01006404614</a></div>
              <div class="contact-info-item"><i class="fas fa-envelope"></i><a href="mailto:shamymediaeg@gmail.com" class="text-decoration-none text-dark">shamymediaeg@gmail.com</a></div>
              <hr class="my-4">
              <h5 class="mb-3">تابعنا على:</h5>
              <div class="social-icons"><a href="#" target="_blank"><i class="fab fa-instagram"></i></a><a href="#" target="_blank"><i class="fab fa-twitter"></i></a><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="ratio ratio-16x9" style="border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4053.110004188214!2d31.195507575552554!3d30.013462674939177!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x145846edbfabd573%3A0xf1694f2f21218509!2sDr.%20Abdelaziz%20Moussa%20-%20Alshomoukh%20Dentistry!5e1!3m2!1sen!2seg!4v1762983722731!5m2!1sen!2seg" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <footer class="footer">
    <div class="container"><p>© 2025 عيادة الشامي. جميع الحقوق محفوظة.</p></div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ====== CONFIG - تم وضع رابط السكريبت المنشور هنا ======
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwPZzfRXEgajN1qDEdTgLJfd3HclaU6lGpH9S1ItIR5VG6rU-OYnAeAgxvIRagGXSI5Yw/exec';
    const CLINIC_WHATSAPP_NUMBER = '201006404614';

    // عناصر DOM
    const doctorCardsContainer = document.getElementById('doctorCardsContainer');
    const heroDoctorSelect = document.getElementById('heroDoctorSelect');
    const heroDateInput = document.getElementById('heroDateInput');
    const heroBookBtn = document.getElementById('heroBookBtn');
    const mainForm = document.getElementById('mainBookingForm');
    const mainDoctorSelect = document.getElementById('mainDoctorSelect');
    const mainDateInput = document.getElementById('mainDateInput');
    const mainTimeSelect = document.getElementById('mainTimeSelect');
    const mainSubmitButton = document.getElementById('mainSubmitButton');
    const mainMessageArea = document.getElementById('mainMessageArea');
    const mainPatientNameInput = document.getElementById('mainPatientName');
    const mainPatientPhoneInput = document.getElementById('mainPatientPhone');
    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
    let currentToken = null;
    let doctorSchedules = null;

    // ضبط الحد الأدنى للتاريخ
    const today = new Date().toISOString().split('T')[0];
    mainDateInput.min = today;
    heroDateInput.min = today;

    document.addEventListener('DOMContentLoaded', async () => {
      await generateTokenOnLoad();
      await loadDoctorSchedules();
      mainDoctorSelect.addEventListener('change', updateAvailableTimes);
      mainDateInput.addEventListener('change', updateAvailableTimes);
      heroBookBtn.addEventListener('click', () => {
        const sDoctor = heroDoctorSelect.value;
        const sDate = heroDateInput.value;
        if (!sDoctor || !sDate) {
          alert('اختر الطبيب والتاريخ أولاً للمتابعة');
          return;
        }
        mainDoctorSelect.value = sDoctor;
        mainDateInput.value = sDate;
        updateAvailableTimes();
        document.getElementById('booking').scrollIntoView({ behavior: 'smooth' });
      });
    });

    async function generateTokenOnLoad() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=generateToken`);
        if (!res.ok) throw new Error('Token request failed');
        currentToken = await res.text();
      } catch (err) {
        console.error('Token generation error', err);
        showMessage('لا يمكن بدء جلسة آمنة. يرجى تحديث الصفحة.', 'danger', document.querySelector('.hero-booking-card'));
      }
    }

    async function loadDoctorSchedules() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getDoctorSchedules`);
        if (!res.ok) throw new Error('Schedules request failed');
        doctorSchedules = await res.json();
        doctorCardsContainer.innerHTML = '';
        mainDoctorSelect.innerHTML = '<option value="" selected disabled>-- اختر الطبيب --</option>';
        heroDoctorSelect.innerHTML = '<option value="" selected disabled>اختر الطبيب</option>';

        for (const key in doctorSchedules) {
          const d = doctorSchedules[key];
          const scheduleDays = d.days.map(i => ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'][i]).join('، ');
          const imageName = key.toLowerCase().replace('.', '').replace(/\s+/g, '_') + '.png';
          const cardHtml = `
            <div class="col-lg-4 col-md-6">
              <div class="card doctor-card h-100">
                <img loading="lazy" src="images/${imageName}" class="card-img-top" alt="${d.name}">
                <div class="card-body d-flex flex-column text-center">
                  <h5 class="fw-bold">${d.name}</h5>
                  <p class="text-muted mb-2">${d.specialty}</p>
                  <div class="mt-auto text-start doctor-schedule">
                    <p class="mb-1"><i class="far fa-calendar-alt"></i> ${scheduleDays}</p>
                    <p class="mb-0"><i class="far fa-clock"></i> ${d.startHour}:00 - ${d.endHour}:00</p>
                  </div>
                </div>
              </div>
            </div>`;
          doctorCardsContainer.insertAdjacentHTML('beforeend', cardHtml);

          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = `${d.name} - ${d.specialty}`;
          mainDoctorSelect.appendChild(opt.cloneNode(true));
          heroDoctorSelect.appendChild(opt.cloneNode(true));
        }
      } catch (err) {
        console.error('Failed to load doctor schedules:', err);
        doctorCardsContainer.innerHTML = '<p class="text-danger text-center w-100">فشل تحميل بيانات الأطباء. يرجى المحاولة مرة أخرى.</p>';
      }
    }

    async function updateAvailableTimes() {
      const doctorKey = mainDoctorSelect.value;
      const date = mainDateInput.value;
      mainTimeSelect.disabled = true;
      mainTimeSelect.innerHTML = '<option>جاري تحميل المواعيد...</option>';
      if (!doctorKey || !date) {
        mainTimeSelect.innerHTML = '<option value="" selected disabled>اختر طبيبًا وتاريخًا</option>';
        return;
      }
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getAvailableTimes&doctor=${encodeURIComponent(doctorKey)}&date=${encodeURIComponent(date)}`);
        if (!res.ok) throw new Error('getAvailableTimes failed');
        const times = await res.json();
        mainTimeSelect.innerHTML = '';
        if (Array.isArray(times) && times.length) {
          times.forEach(t => { const o = document.createElement('option'); o.value = t; o.textContent = t; mainTimeSelect.appendChild(o); });
          mainTimeSelect.disabled = false;
        } else {
          mainTimeSelect.innerHTML = '<option value="" disabled>لا توجد مواعيد متاحة</option>';
        }
      } catch (err) {
        console.error('Failed to get available times:', err);
        mainTimeSelect.innerHTML = '<option value="" disabled>خطأ في تحميل المواعيد</option>';
      }
    }

    mainForm.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      mainMessageArea.innerHTML = '';
      if (!mainForm.checkValidity() || !currentToken) {
        mainForm.classList.add('was-validated');
        if (!currentToken) showMessage('جلسة منتهية، يرجى إعادة تحميل الصفحة.', 'danger');
        return;
      }
      mainSubmitButton.disabled = true;
      mainSubmitButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جارٍ التأكيد...`;

      const payload = {
        patientName: mainPatientNameInput.value.trim(),
        patientPhone: mainPatientPhoneInput.value.trim(),
        doctor: mainDoctorSelect.value,
        date: mainDateInput.value,
        time: mainTimeSelect.value,
        token: currentToken
      };

      try {
        const dataStr = encodeURIComponent(JSON.stringify(payload));
        const res = await fetch(`${WEB_APP_URL}?action=bookAppointment&data=${dataStr}`);
        if (!res.ok) throw new Error('Booking request failed');
        const result = await res.json();
        if (result.status === 'success') {
          document.getElementById('modalSummary').textContent = `${payload.patientName} - ${payload.date} ${payload.time} مع ${doctorSchedules[payload.doctor].name}`;
          const waMsg = `مرحباً عيادة الشامي، لقد قمت بتأكيد حجز باسم ${payload.patientName} مع ${doctorSchedules[payload.doctor].name} في ${payload.date} الساعة ${payload.time}.`;
          document.getElementById('whatsappLink').href = `https://wa.me/${CLINIC_WHATSAPP_NUMBER}?text=${encodeURIComponent(waMsg)}`;
          successModal.show();
          mainForm.reset();
          mainForm.classList.remove('was-validated');
          mainTimeSelect.innerHTML = '<option value="" selected disabled>اختر طبيبًا وتاريخًا</option>';
        } else {
          showMessage(result.message || 'حدث خطأ أثناء الحجز.', 'danger');
        }
      } catch (err) {
        console.error('Fetch Error:', err);
        showMessage('حدث خطأ في الاتصال. يرجى التحقق من الشبكة والمحاولة مرة أخرى.', 'danger');
      } finally {
        await generateTokenOnLoad();
        mainSubmitButton.disabled = false;
        mainSubmitButton.innerHTML = 'تأكيد الحجز';
      }
    });

    function showMessage(msg, type = 'danger', container = mainMessageArea) {
      const t = type === 'success' ? 'success' : 'danger';
      container.innerHTML = `<div class="alert alert-${t} alert-dismissible fade show" role="alert">${msg}<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
    }
  </script>
</body>
</html>
